<VirtualHost *:80>

   ServerName hda
   ServerAlias setup
   ServerAlias search
   ServerAlias home
   ServerAlias network
   ServerAlias help

   ServerAlias hda.@HDA_DOMAIN@
   ServerAlias setup.@HDA_DOMAIN@
   ServerAlias search.@HDA_DOMAIN@
   ServerAlias home.@HDA_DOMAIN@
   ServerAlias network.@HDA_DOMAIN@
   ServerAlias help.@HDA_DOMAIN@

   DocumentRoot /var/hda/platform/html/public

   ErrorLog  /var/hda/platform/logs/error_log
   CustomLog /var/hda/platform/logs/access_log combined env=!dontlog

   RewriteEngine On
   RewriteRule ^/_PKGS/(.*)$ /var/hda/platform/apps/$1 [last]
   RewriteRule ^/images/\.\./_PKGS/(.*)$ /var/hda/platform/apps/$1 [last]
   RewriteRule ^/_USERS/(.*)$ /var/hda/platform/users/$1 [last]
   RewriteRule ^/_PIC/(.*)$ /var/hda/files/pictures/$1 [last]

   RewriteCond %{HTTP_HOST}   ^search$ [NC]
   RewriteRule ^/(.*)         http://hda/search/$1 [L,R]
   RewriteCond %{HTTP_HOST}   ^setup$ [NC]
   RewriteRule ^/(.*)         http://hda/setup/$1 [L,R]
   RewriteCond %{HTTP_HOST}   ^home$ [NC]
   RewriteRule ^/(.*)         http://hda/$1 [L,R]
   RewriteCond %{HTTP_HOST}   ^help$ [NC]
   RewriteRule ^/(.*)         http://hda/help/$1 [L,R]
   # FIXME: temporary until we have a setup page for network
   RewriteCond %{HTTP_HOST}   ^network$ [NC]
   RewriteRule ^/(.*)         http://hda/setup/$1 [L,R]

   # this was only for FCGI
   # DefaultInitEnv  RAILS_ENV production
   # SocketPath /tmp/fcgidsock
   # DirectoryIndex dispatch.cgi
   # DirectoryIndex dispatch.fcgi

   ErrorDocument 500 "<h2>Application error</h2>Rails application failed to start properly"

   <Location />
	RewriteEngine On
	RewriteRule ^$ index.html [QSA]
	RewriteRule ^([^.]+)$ $1.html [QSA]
	# Let apache handle purely static files like images by itself.
	RewriteCond %{REQUEST_FILENAME} !-f
	# Send Everything else to the dispatcher
	# RewriteRule ^(.*)$ dispatch.cgi [QSA,L] 
	RewriteRule ^(.*)$ dispatch.fcgi [QSA,L] 
   </Location>

   <Directory /var/hda/platform/html/public>
      Options Indexes FollowSymLinks ExecCGI
      # AddHandler cgi-script .cgi
      AddHandler fcgid-script .fcgi fcgi
      AllowOverride all
      Order allow,deny
      Allow from all
      Require all granted
   </Directory>

</VirtualHost>
